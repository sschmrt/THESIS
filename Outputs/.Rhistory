library(readr)
library(dplyr)
library(tidyr)
# Step 1: Specify the column names as described
col_names <- c(
"run", "mean_speed_ped", "mean_speed_bike", "stddev_speed_ped", "stddev_speed_bike",
"Nb_Bikes", "A_bike", "bik_S", "ped_goer", "Tr_bike", "bik_E", "V0_ped", "D", "ped_S",
"A_ped", "ped_E", "bik_N", "bike_goer", "Ferry", "ped_N", "bike_comer", "bik_W", "Tr_ped",
"ped_comer", "ped_W", "Nb_peds", "v0_bike", "total_severe", "total_moderate", "total_mild"
)
# Read the CSV file (update filename)
setwd("C:/Users/marta/Desktop/THESIS/Outputs")
dat <- read_csv("V0Bikes.csv", col_names = col_names, show_col_types = FALSE)
# Step 3: Calculate per-run CVs
dat <- dat %>%
mutate(
CV_ped = stddev_speed_ped / mean_speed_ped,
CV_bike = stddev_speed_bike / mean_speed_bike
)
# Step 4: Group by v0_bike, calculate summary stats
summary_stats <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_mean_speed_ped = mean(mean_speed_ped, na.rm = TRUE),
mean_mean_speed_bike = mean(mean_speed_bike, na.rm = TRUE),
mean_stddev_speed_ped = mean(stddev_speed_ped, na.rm = TRUE),
mean_stddev_speed_bike = mean(stddev_speed_bike, na.rm = TRUE),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
total_severe = mean(total_severe, na.rm = TRUE)
total_moderate = mean(total_moderate, na.rm = TRUE),
# Step 4: Group by v0_bike, calculate summary stats
summary_stats <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_mean_speed_ped = mean(mean_speed_ped, na.rm = TRUE),
mean_mean_speed_bike = mean(mean_speed_bike, na.rm = TRUE),
mean_stddev_speed_ped = mean(stddev_speed_ped, na.rm = TRUE),
mean_stddev_speed_bike = mean(stddev_speed_bike, na.rm = TRUE),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
total_severe = mean(total_severe, na.rm = TRUE),
total_moderate = mean(total_moderate, na.rm = TRUE),
total_mild = mean(total_mild, na.rm = TRUE)
) %>%
ungroup()
# Step 5: Save summary table for Excel/plots
write_csv(summary_stats, "ofat_summary_by_v0bike.csv")
View(summary_stats)
# Step 4: Group by v0_bike, calculate summary stats
summary_stats <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_mean_speed_ped = mean(mean_speed_ped, na.rm = TRUE),
mean_mean_speed_bike = mean(mean_speed_bike, na.rm = TRUE),
mean_stddev_speed_ped = mean(stddev_speed_ped, na.rm = TRUE),
mean_stddev_speed_bike = mean(stddev_speed_bike, na.rm = TRUE),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
total_severe = mean(total_severe, na.rm = TRUE),
total_moderate = mean(total_moderate, na.rm = TRUE),
total_mild = mean(total_mild, na.rm = TRUE)
) %>%
formatStyle('total_severe',
backgroundColor = styleInterval(c(10000, 15000), c('lightgreen', 'yellow', 'red'))) %>%
formatStyle('total_moderate',
backgroundColor = styleInterval(c(5000, 10000), c('lightblue', 'orange', 'darkred'))) %>%
formatStyle('total_mild',
backgroundColor = styleInterval(c(15000, 20000), c('lavender', 'lightpink', 'deeppink')))
ungroup()
# Step 4: Group by v0_bike, calculate summary stats
summary_stats <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_mean_speed_ped = mean(mean_speed_ped, na.rm = TRUE),
mean_mean_speed_bike = mean(mean_speed_bike, na.rm = TRUE),
mean_stddev_speed_ped = mean(stddev_speed_ped, na.rm = TRUE),
mean_stddev_speed_bike = mean(stddev_speed_bike, na.rm = TRUE),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
total_severe = mean(total_severe, na.rm = TRUE),
total_moderate = mean(total_moderate, na.rm = TRUE),
total_mild = mean(total_mild, na.rm = TRUE)
) %>%
ungroup()
# Step 1: Specify the column names as described
col_names <- c(
"run", "mean_speed_ped", "mean_speed_bike", "stddev_speed_ped", "stddev_speed_bike",
"Nb_Bikes", "A_bike", "bik_S", "ped_goer", "Tr_bike", "bik_E", "V0_ped", "D", "ped_S",
"A_ped", "ped_E", "bik_N", "bike_goer", "Ferry", "ped_N", "bike_comer", "bik_W", "Tr_ped",
"ped_comer", "ped_W", "Nb_peds", "v0_bike", "total_severe", "total_moderate", "total_mild"
)
# Read the CSV file (update filename)
setwd("C:/Users/marta/Desktop/THESIS/Outputs")
dat <- read_csv("V0Bikes.csv", col_names = col_names, show_col_types = FALSE)
# Step 3: Calculate per-run CVs
dat <- dat %>%
mutate(
CV_ped = stddev_speed_ped / mean_speed_ped,
CV_bike = stddev_speed_bike / mean_speed_bike
)
# Step 4: Group by v0_bike, calculate summary stats
summary_stats <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_mean_speed_ped = mean(mean_speed_ped, na.rm = TRUE),
mean_mean_speed_bike = mean(mean_speed_bike, na.rm = TRUE),
mean_stddev_speed_ped = mean(stddev_speed_ped, na.rm = TRUE),
mean_stddev_speed_bike = mean(stddev_speed_bike, na.rm = TRUE),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
total_severe = mean(total_severe, na.rm = TRUE),
total_moderate = mean(total_moderate, na.rm = TRUE),
total_mild = mean(total_mild, na.rm = TRUE)
) %>%
ungroup()
# Step 5: Save summary table for Excel/plots
write_csv(summary_stats, "ofat_summary_by_v0bike.csv")
View(summary_stats)
View(summary_stats)
# Step 4: Group by v0_bike, calculate summary stats
summary_stats <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_mean_speed_ped = mean(mean_speed_ped, na.rm = TRUE),
mean_mean_speed_bike = mean(mean_speed_bike, na.rm = TRUE),
mean_stddev_speed_ped = mean(stddev_speed_ped, na.rm = TRUE),
mean_stddev_speed_bike = mean(stddev_speed_bike, na.rm = TRUE),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
total_severe = mean(total_severe, na.rm = TRUE),
total_moderate = mean(total_moderate, na.rm = TRUE),
total_mild = mean(total_mild, na.rm = TRUE)
) %>%
ungroup()
# Step 5: Save summary table for Excel/plots
write_csv(v0, "ofat_summary_by_v0bike.csv")
# Step 3: Calculate per-run CVs
dat <- dat %>%
mutate(
CV_ped = stddev_speed_ped / mean_speed_ped,
CV_bike = stddev_speed_bike / mean_speed_bike
)
# Step 4: Group by v0_bike, calculate summary stats
v0 <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_mean_speed_ped = mean(mean_speed_ped, na.rm = TRUE),
mean_mean_speed_bike = mean(mean_speed_bike, na.rm = TRUE),
mean_stddev_speed_ped = mean(stddev_speed_ped, na.rm = TRUE),
mean_stddev_speed_bike = mean(stddev_speed_bike, na.rm = TRUE),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
total_severe = mean(total_severe, na.rm = TRUE),
total_moderate = mean(total_moderate, na.rm = TRUE),
total_mild = mean(total_mild, na.rm = TRUE)
) %>%
ungroup()
# Step 5: Save summary table for Excel/plots
write_csv(v0, "ofat_summary_by_v0bike.csv")
library(readr)
library(dplyr)
library(tidyr)
# Step 1: Specify the column names as described
col_names <- c(
"run", "mean_speed_ped", "mean_speed_bike", "stddev_speed_ped", "stddev_speed_bike",
"Nb_Bikes", "A_bike", "bik_S", "ped_goer", "Tr_bike", "bik_E", "V0_ped", "D", "ped_S",
"A_ped", "ped_E", "bik_N", "bike_goer", "Ferry", "ped_N", "bike_comer", "bik_W", "Tr_ped",
"ped_comer", "ped_W", "Nb_peds", "v0_bike", "total_severe", "total_moderate", "total_mild"
)
# Read the CSV file (update filename)
setwd("C:/Users/marta/Desktop/THESIS/Outputs")
dat <- read_csv("V0Bikes.csv", col_names = col_names, show_col_types = FALSE)
# Step 3: Calculate per-run CVs
dat <- dat %>%
mutate(
CV_ped = stddev_speed_ped / mean_speed_ped,
CV_bike = stddev_speed_bike / mean_speed_bike
)
# Step 4: Group by v0_bike, calculate summary stats INCLUDING CVs for conflicts
v0 <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
cv_severe = sd(total_severe, na.rm = TRUE) / mean(total_severe, na.rm = TRUE),
cv_moderate = sd(total_moderate, na.rm = TRUE) / mean(total_moderate, na.rm = TRUE),
cv_mild = sd(total_mild, na.rm = TRUE) / mean(total_mild, na.rm = TRUE)
) %>%
ungroup()
# Step 5: Combine CVs into a single metric
v0 <- v0 %>%
mutate(
total_CV = mean(c(mean_CV_ped, mean_CV_bike, cv_severe, cv_moderate, cv_mild), na.rm = TRUE) # or sum() for total
)
# Step 6: Find the v0_bike with the lowest overall CV
best_v0 <- v0 %>%
filter(total_CV == min(total_CV, na.rm = TRUE))
print(v0)
cat("Best v0_bike for lowest total CV is:\n")
print(best_v0$v0_bike)
View(best_v0)
View(best_v0)
# Step 1: Specify the column names as described
col_names <- c(
"run", "mean_speed_ped", "mean_speed_bike", "stddev_speed_ped", "stddev_speed_bike",
"Nb_Bikes", "A_bike", "bik_S", "ped_goer", "Tr_bike", "bik_E", "V0_ped", "D", "ped_S",
"A_ped", "ped_E", "bik_N", "bike_goer", "Ferry", "ped_N", "bike_comer", "bik_W", "Tr_ped",
"ped_comer", "ped_W", "Nb_peds", "v0_bike", "total_severe", "total_moderate", "total_mild"
)
# Read the CSV file (update filename)
setwd("C:/Users/marta/Desktop/THESIS/Outputs")
dat <- read_csv("V0Bikes.csv", col_names = col_names, show_col_types = FALSE)
# Step 3: Calculate per-run CVs
dat <- dat %>%
mutate(
CV_ped = stddev_speed_ped / mean_speed_ped,
CV_bike = stddev_speed_bike / mean_speed_bike
)
# Step 4: Group by v0_bike, calculate summary stats INCLUDING CVs for conflicts
v0 <- dat %>%
group_by(v0_bike) %>%
summarise(
n_runs = n(),
mean_CV_ped = mean(CV_ped, na.rm = TRUE),
mean_CV_bike = mean(CV_bike, na.rm = TRUE),
cv_severe = sd(total_severe, na.rm = TRUE) / mean(total_severe, na.rm = TRUE),
cv_moderate = sd(total_moderate, na.rm = TRUE) / mean(total_moderate, na.rm = TRUE),
cv_mild = sd(total_mild, na.rm = TRUE) / mean(total_mild, na.rm = TRUE)
) %>%
ungroup()
# Step 5: Combine CVs into a single metric
v0 <- v0 %>%
mutate(
total_CV = rowMeans(select(., mean_CV_ped, mean_CV_bike, cv_severe, cv_moderate, cv_mild), na.rm = TRUE)
)
# Step 6: Find the v0_bike with the lowest overall CV
best_v0 <- v0 %>%
filter(total_CV == min(total_CV, na.rm = TRUE))
print(v0)
cat("Best v0_bike for lowest total CV is:\n")
print(best_v0$v0_bike)
